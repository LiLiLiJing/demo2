<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>demo</title>
		<meta name="description" content="">
		<meta name="keywords" content="">
		<script src="../static/libs/jquery-1.11.2.min.js" type="text/javascript"></script>
		<style type="text/css">
			* {
            padding: 0;
            margin: 0;
			font: 14px "微软雅黑";
        	}
			body{
				background-color:#eee;
				}
			img{
				border:none;
				width:100px;
				height:100px;
				}
	        table {
	            border-collapse: collapse;
	            border-spacing: 0;
	            border: 1px solid #c0c0c0;
	            width: 95%;
	            margin-bottom:15px;
				}
	        table:hover{
	            background-color: #fafafa;
	        }
	        table div{
            font-size:14px;
            font-weight:bold;
        	}
	        th,
	        td {
	            border: 1px solid #d0d0d0;
	            color: #404060;
	            padding: 10px;
	        }
	        td{
            
            word-break:break-all;
            
	        }
	        .main{
				width:900px;
	        	margin:10px auto;
	        }
	        .orderNum{
	        	margin-right:25px;
	        	font-size:14px;
            	font-weight:bold;
	        }
	        .creatTime{
	        	font-size:14px;
            	font-weight:bold;
	        }
	        .deal{
	        	cursor:pointer;
	        	min-width:40px;
	        }
			.tdstyle{
				width:22%;
			}
			.selectOrder{
				width:900px;
				margin:10px auto;
			}
			.selectTitle{
				display:inline-block;
				border:1px solid #bfbfbf;
				width:72px;
			}
			.allOrder{
				position:relative;
				margin-left:5px;
			}
			.trangle{
				display:inline-block;
				width: 0;
			    height: 0;
			    border-left: 6px solid transparent;
			    border-right: 6px solid transparent;
			    border-top: 10px solid #bfbfbf;
			    margin-left: 30px;
			}
			.orderDate{
				display:block;
				margin:3px 0;
				cursor:pointer;
			}
			.orderDate:hover{
				background-color:#56A9D3;
				color:#666;
			}
			.selectItems{
				position:absolute;
				top:20px;
				left:0;
				width:72px;
				background-color:#eee;
				padding-left:5px;
				border:1px solid #bfbfbf;
				margin-top: -1px;
				display:none;
			}
			.selectTitle{
				cursor:pointer;
				padding-left:5px;
			}
			.selectUser{
				margin-right: 5px;
			}
		</style>
	</head>
	
	<body>
		<div class="selectOrder">
			<span class="selectUser">
				<span>用户名:</span>
				<span class="userName">{{store_dict['user_name']}}</span>
			</span>
			<span class="select">订单筛选:</span>
			<span class="allOrder">
				<span class="selectTitle">
					全部<div class="trangle"></div>
				</span>
				<div class="selectItems">
					<span class="orderDate">过去3天</span>
					<span class="orderDate">过去7天</span>
					<span class="orderDate">过去15天</span>
					<span class="orderDate">过去30天</span>
				</div>
			</span>

		</div>
		
		<div class="main">
			
		</div>
	</body>
	<script type="text/javascript">
		function show(){
			$.ajax({
				url:'http://172.18.77.15:{{store_dict['port_number']}}/lblorder-manip&get-orders',
				type:"POST",
				dataType:'JSON',
				success:function(data){
					var str="";
					var obj="";
					var user="";
					var space="";
	                for(var i=0;i<data.length;i++){
	                    obj=data[i].objtypes.slice(9);
	                    user=data[i].users.slice(6);
	                    space=data[i].workspace.slice(10);
	                    str +='<table>';
	                    str +='<tr><td colspan="5"><span class="orderNum titleSty">订单编号：'+data[i].id+'</span><span class="creatTime titleSty">创建时间：'+data[i].start_time+'</span></td></tr>';
	                    str+= '<tr><td class="descript tdstyle"><div>Description:</div>'+data[i].description+'</td><td class="type tdstyle"><div>ObjTypes:</div>'+obj+'</td><td class="user tdstyle"><div>Users:</div>'+user+'</td><td class="workspace tdstyle"><div>Workspace:</div>'+space+'</td><td><div class="deal" data-index='+data[i].id+'>处理</div></td></tr>';
	                    str+='</table>';
	                };
                	$('.main').html(str);
                	var dealArr=document.getElementsByClassName("deal");

					for(var j=0;j<dealArr.length;j++){
						dealArr[j].onclick=function(){
							var flag=this.dataset['index'];
							/*$.ajax({
								url:"http://172.18.77.15:{{store_dict['port_number']}}/lblorder-manip&proc-order",
								data: {'id': flag},
								datatype:'JSON',
								type:'POST',
								success:function(data){
									console.log(data);*/
									window.location.href="http://172.18.77.15:{{store_dict['port_number']}}/lblorder-manip&proc-order:"+flag;
								/*},*/
								/*error:function(err){

								}*/
							//})
						}
					}
					
						
						//3.计算差值，如果小于等于所选数字，显示，否则设置隐藏
					
					//根据用户名筛选订单
					function showOrder(data1){
						var str="";
						var obj="";
						var user="";
						var space="";
		                for(var i=0;i<data1.length;i++){
		                    obj=data1[i].objtypes.slice(9);
		                    user=data1[i].users.slice(6);
		                    space=data1[i].workspace.slice(10);
		                    str +='<table>';
		                    str +='<tr><td colspan="5"><span class="orderNum titleSty">订单编号：'+data1[i].id+'</span><span class="creatTime titleSty">创建时间：'+data1[i].start_time+'</span></td></tr>';
		                    str+= '<tr><td class="descript tdstyle"><div>Description:</div>'+data1[i].description+'</td><td class="type tdstyle"><div>ObjTypes:</div>'+obj+'</td><td class="user tdstyle"><div>Users:</div>'+user+'</td><td class="workspace tdstyle"><div>Workspace:</div>'+space+'</td><td><div class="deal" data-index='+data1[i].id+'>处理</div></td></tr>';
		                    str+='</table>';
		                };
	                	$('.main').html(str);
	                	var dealArr=document.getElementsByClassName("deal");

						for(var j=0;j<dealArr.length;j++){
							dealArr[j].onclick=function(){
								var flag=this.dataset['index'];
								/*$.ajax({
									url:"http://172.18.77.15:{{store_dict['port_number']}}/lblorder-manip&proc-order",
									data: {'id': flag},
									datatype:'JSON',
									type:'POST',
									success:function(data){
										console.log(data);*/
										window.location.href="http://172.18.77.15:{{store_dict['port_number']}}/lblorder-manip&proc-order:"+flag;
									/*},*/
									/*error:function(err){

									}*/
								//})
							}
						}
					}
					var userName=$(".userName").text();
					var dataArr=[];
					console.log(userName);
					for(var q=0;q<data.length;q++){
						var index=data[q].users.slice(6).indexOf(userName);
						if(index!==-1){
							dataArr.push(data[q]);
							//重新加载订单
							showOrder(dataArr);
							//筛选订单
							/*$(".selectTitle").on("click",function(){
								if($(".selectItems").css("display")=="none"){
									$(".selectItems").css({"display":"block"});
								}else{
									$(".selectItems").css({"display":"none"});
								}	
							});*/
							/*$(".orderDate").on("click",function(){
								//通过正则表达式提取字符串中的数字
								//console.log($(this).text().replace(/[^0-9]/ig,""));
								//1.获取当前日期
								var nowTime=new Date();
								var ago,agoArr,month;
								var monthArr=["Jan","Feb","Mar","Apr","May","June","July","Aug","Sep","Otc","Nov","Dec"];
								var dayArr=[];
								//2.获取所有订单创建日期
								for(var k=0;k<dataArr.length;k++){
									ago=dataArr[k].start_time;
								
									agoDate=ago.substring(5,25);
									agoArr=agoDate.split(" ");
									for(var l=0;l<monthArr.length;l++){
										if(agoArr[1]==monthArr[l]){
											month=(l+1);
											month=month<10?"0"+month:month;

											agoArr[1]=month.toString();
										}
									}
									
									var target = new Date(agoArr[2]+"/"+agoArr[1]+"/"+agoArr[0]);
									var timeSum = nowTime.getTime() - target.getTime();
									var day = parseInt(timeSum/1000/60/60/24);
									var targetNum=$(this).text().replace(/[^0-9]/ig,"");
									var str1="";
									
									dayArr.push(day);
									
									if(day<targetNum){
										
										
										var obj1=dataArr[k].objtypes.slice(9);
					                    var user1=dataArr[k].users.slice(6);
					                    var space1=dataArr[k].workspace.slice(10);
					                    str1 +='<table>';
					                    str1 +='<tr><td colspan="5"><span class="orderNum titleSty">订单编号：'+dataArr[k].id+'</span><span class="creatTime titleSty">创建时间：'+dataArr[k].start_time+'</span></td></tr>';
					                    str1+= '<tr><td class="descript tdstyle"><div>Description:</div>'+dataArr[k].description+'</td><td class="type tdstyle"><div>ObjTypes:</div>'+obj1+'</td><td class="user tdstyle"><div>Users:</div>'+user1+'</td><td class="workspace tdstyle"><div>Workspace:</div>'+space1+'</td><td><div class="deal" data-index='+dataArr[k].id+'>处理</div></td></tr>';
					                    str1+='</table>';


									}
									$('.main').html(str1);
								}
								//console.log(dayArr);
								//遍历天数数组，匹配与筛选天数一致的数据
								for(var w=0;w<dayArr.length;w++){
									if(dayArr[w]<=targetNum){
										console.log(dayArr[w]);
									}
								}
								
							})*/
						}
					}
				},
				error:function(err){
					console.log(err);
				}
			})
		}
		//show();
		function showOrder(){
			$.ajax({
				url:'http://172.18.77.15:{{store_dict['port_number']}}/lblorder-manip&get-orders',
				type:"POST",
				dataType:'JSON',
				success:function(data){
					console.log(data);
				},
				error:function(err){
					console.log(err);
				}
		
	</script>
</html>