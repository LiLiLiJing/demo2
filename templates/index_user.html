<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>demo</title>
		<meta name="description" content="">
		<meta name="keywords" content="">
		<script src="../static/libs/jquery-1.11.2.min.js" type="text/javascript"></script>
		<style type="text/css">
			* {
            padding: 0;
            margin: 0;
			font: 14px "微软雅黑";
        	}
			body{
				background-color:#eee;
				}
			img{
				border:none;
				width:100px;
				height:100px;
				}
			ul,ol{
				list-style:none;
			}
	        table {
	            border-collapse: collapse;
	            border-spacing: 0;
	            border: 1px solid #c0c0c0;
	            width: 95%;
	            margin-bottom:15px;
				}
	        table:hover{
	            background-color: #fafafa;
	        }
	        table div{
            font-size:14px;
            font-weight:bold;
        	}
	        th,
	        td {
	            border: 1px solid #d0d0d0;
	            color: #404060;
	            padding: 10px;
	        }
	        td{
            
            word-break:break-all;
            
	        }
	        .info{
	        	width: 1300px;
				margin:25px auto;
	        }
	        .contents{
	        	width:1300px;
	        	margin:0 auto;
	        	position:relative;
	        }
	        .fl{
	        	float:left;
	        }
	        .fr{
	        	float:right;
	        }
	        .clearfix:after{
				content:'';
				display:block;
				clear:both;
			}
			.left{
				margin:5px;
				overflow-y:auto;
				width:220px;
			}
			.left ul{
				width:200px;
			}
			.left li{
				background-color:#4876FF; 
				margin-bottom:5px;
				height:58px;
				overflow:hidden;
				cursor:pointer;
				border-radius:20px;
				padding-left:8px;
				border-bottom:;
				color:#fff;
				border:3px solid #bbb;
			}
			.left li div{
				overflow: hidden;

				white-space: nowrap;

				text-overflow: ellipsis;
			}
			.right{
				width: 1090px;
				
				position:absolute;
				top:0px;
				left:238px;
				overflow-y:auto;
				margin:5px;
			}
			.imgBox{

			}
			.right .oneBox{
				width:100px;

				margin:0 5px;
				margin-bottom: 5px;
				cursor:pointer;
            	text-align:center;
				position:relative;
				display:inline-block;
				
			}
			.oneBox span{
				display:block;
				width:100px;
				height:36px;
				word-wrap: break-word;
				overflow:hidden;
			}
			.infoBox{
				background-color: skyblue;
				color:#000;
				border-radius:5px;
				width:980px;
				height:108px;
				margin-top:16px;
				display:none;
				position:absolute;
				top:140px;
				left:0;
				padding:5px 0;
				z-index:10;
				cursor:default;
				text-align:left;
			}
			.shape{
				width: 0;
    			height: 0;
    			border-left: 10px solid transparent;
    			border-right: 10px solid transparent;
    			border-bottom: 15px solid skyblue;
    			position:absolute;
    			top:141px;
				left:40px;
				display:none;
			}
			.selTime{
				width:84px;
			}
			.select{
				margin-left: 10px;
				margin-right: 10px;
			}
			#begin{
				width:90%;
				height:100%;
				text-align:center;
				font-size:60px;
				color:rgba(0, 0, 255, .7);
				font-weight:600;
				margin-top:15px;
				letter-spacing:20px;
			}
			.headleft .userBox{
				float:right;
				color:#000;
				font-size:14px;
				margin-top:28px;
			}
			.empty{
				background-color:#eee!important;
				font-size:18px!important;
				color:#000!important;
			}
			.orderInfo{
				width:900px;
				margin-bottom:20px;
				display:none;
			}
			.header{
				width:100%;
				height:60px;
				background-color:#4c4e5a;
			}
			.headleft{
				width: 1300px;
				height: 60px;
				margin:0 auto;
				

			}
			.headleft .title{
				font-size:25px;
				color:#fff;
				font-weight:bold;
				margin-top:12px;
				margin-left:5px;
				float:left;
			}
			.headleft .rightstyle{
				color:#fff!important;
				font-size:14px;
				margin-bottom:5px;
			}

			.headleft img{
				height:50px;
				width: 50px;
				margin-top:5px;
				float:left;
			}
			.ongoing{
				width:10px;
				height: 10px;
				border-radius:5px;
				background-color:red;
				position:absolute;
				top:4px;
				right:4px;
			}
			.finished{
				width:10px;
				height: 10px;
				border-radius:5px;
				background-color:green;
				position:absolute;
				top:4px;
				right:4px;
			}
			.nodo{
				width:10px;
				height: 10px;
				border-radius:5px;
				background-color:#fff;
				position:absolute;
				top:4px;
				right:4px;
			}
			.infoBox .imginfo{
				margin-left:10px;
			}
			.infoBox .comment{
				float:left;
				position:relative;
				margin-left:10px;
				width:410px;
				height:70px;
			}
			.infoBox .commentTitle{
				position:absolute;
				top:0px;
				left:0px;
				width:80px;
			}
			.infoBox textarea{
				position:absolute;
				top:18px;
				left:0;
				resize: none;
				outline:none;
				width:400px;
				height:48px;
			}
			.infoBox .paint{
				float:left;
				margin-left:10px;
				padding-top:14px;
			}
			.infoBox .paint .switch{
				width:50px;
				height:25px;
				background-color:green;
				position:relative;
				border-radius:25px;
			}
			.infoBox .paint .ball{
				position:absolute;
				width:25px;
				height:25px;
				border-radius:25px;
				background-color:#fff;
				left:25px;
			}
			.imgstatus{

			}
			.infoBox button{
				box-shadow:0 2px 0 gray;
				width:50px;
				border-radius:15px;
			}
			.infoBox .btn2{
				margin-top:5px;
			}
			.infoBox .paint2{
				float:left;
				margin-left:60px;
				padding-top:14px;
			}
			.infoBox .gopaint{
				margin-top:46px;
				color:#fff;
				font-size:20px;
				font-weight:bold;
			}
			.infoBox select{
				display:block;
				border-radius:2px;
				border:none;
				margin-bottom:9px;
				background-color:#eee;
			}
			.infoBox .paint3{
				width:88px;
				height:118px;
				position:absolute;
				background-color:rgba(255,165,0,0.8);
				right:0;
				bottom:0;
				border-radius:5px;
				text-align:center;
				cursor:pointer;
			}
			h3{
				font-size:20px;
				font-weight:800;
				color:gray;
				width:100px;
				border-radius:14px;
				border:2px solid gray;
				border-bottom:none;
				padding-left:5px;
			}
			hr{
				width:980px;
				border:none;
				border-top:2px solid gray;
				margin-bottom:10px;
			}
		</style>
	</head>
	
	<body>
		<div class="header">
			<div class="headleft">
			    <img src="static/images/logo.jpg"/>     
			    <div class="title">Remote Sensing Artificial Intelligence Service 遥感智能服务</div>
			    <div class="userBox">
					<span class="rightstyle"></span>
					<span class="rightstyle">用户名:</span>
					<span class="userName rightstyle">{{store_dict['user_name']}}</span>
					
					<span class="rightstyle">退出登录</span>
				</div>
			</div>
		</div>
		<div class="info">
			<span class="selectUser">
				
				<span class="select">订单筛选:</span>
				<select class="selTime" id="selTime">
					<option value="all" selected="selected">全部</option>
					<option value="3">过去3天</option>
					<option value="7">过去7天</option>
					<option value="30">过去30天</option>
				</select>
			</span>
		</div>
		<div class="contents clearfix">
			
			<div class="left fl">
				<ul>
					
				</ul>
			</div>
			<div class="right fl">
				<div class="orderInfo"></div>
				<div class="clearfix imgBox">
					<div id="begin">欢迎进入</div>
					<div id="begin">遥感智能服务系统</div>

				</div>
				
			</div>
		</div>
		
	</body>
	
	<script type="text/javascript">
		//定义当前用户数据数组
		var userdataArr=[];
		//定义存储图片数组
		var imgdataArr=[];
		$(".contents").height($(window).height()-100);
		$(".left").height($(window).height()-110);
		$(".right").height($(window).height()-110);
		//数组去重
		function unique(arr){
	        var result = [];
	        for(var i=0;i<arr.length;i++){
	            if(result.indexOf(arr[i])==-1){
	                result.push(arr[i])
	            }
	        }
	        return result;
	    }
	    
		//加载右边图片
		function imgInfo(info,index,Sinfo){
			var str="";
			var str1="";
			var storenameArr=[];
			var workspaceArr=[];
			var j=0;
			var oneArr;
			imgdataArr=[];
			for(var i=0;i<info.length;i++){
				var storename=info[i].storename;
				storenameArr.push(storename);
			}
			for(var i=0;i<info.length;i++){
				var spacename=info[i].workspacename;
				workspaceArr.push(spacename);
			}
			workspaceArr=unique(workspaceArr);
			for(var a=0;a<workspaceArr.length;a++){				
				$.ajax({
	                url:'http://{{store_dict['remote_addr']}}:{{store_dict['port_number']}}/thumbnail&'+workspaceArr[a],
	                type:'get',
	                dataType:'JSON',
	                success:function(data){
	                	imgdataArr.push(data);
	                	for(var k=0;k<data.length;k++){
	                			j++;
	                			str1+='<div class="oneBox" data-index="'+j+'">'+
	                			'<img src="'+data[k].url+'">'+
	                			'<span class="imgname">'+data[k].name+'</span>'+
	                			'<div class="imgstatus"></div>'+

	                			'<div class="shape"></div>'+
	                			'<div class="infoBox">'+
	                			'<div class="imginfo">'+
	                			'<div class="imgnm"></div>'+
	                			'<div class="img_status"></div>'+
	                			'<div class="imgmodify"></div>'+
	                			'</div>'+
	                			'<div class="comment">'+
	                			'<div class="commentTitle">描述信息：</div>'+
	                			'<textarea></textarea>'+
	                			'</div>'+
	                			'<div class="paint">'+
	                			'<div class="switch">'+
	                			'<div class="ball"></div>'+
	                			'</div>'+
	                			'<button class="btn2">注册</button>'+
	                			'</div>'+
	                			'<div class="paint2">'+
	                			
	                			'<select class="sortStatus">'+
	                			'<option value="accomplished">已完成</option>'+
	                			'<option value="ongoing" selected="selected">未完成</option>'+
	                			'</select>'+
	                			'<button class="btn1">提交</button>'+
	                			'</div>'+
	                			'<div class="paint3">'+
	                			'<div class="gopaint">标注-></div>'+
	                			'</div>'+
	                			'</div>'+
	                			'</div>'		
	                	}
	                	$(".right .imgBox").html(str1);
	                	
		                
	                	clickImg();

	                	judgeStatus(index,Sinfo);
	                	
	                }

            	})
			}
			//judgeStatus(index);
			
		}
		//页面跳转标注界面单个图片，多张图片
		function goPaint(){
			
				var flagtext=$(this).parent().parent().parent().find("span").text();
	        	window.open('/show&'+flagtext);
	        	//window.open('/lblorder-manip&proc-order:'+index)
		}
		function linkPaint(index){
        	$(".right>.imgBox").find(".much").click(function(){
        		if($(this).parent().find("input").prop("checked")){
        			var flagtext=$(this).parent().parent().find("span").text();
        			window.open('/lblorder-manip&proc-order:'+index+':'+flagtext);
        		}
        	});
    	}

    	//点击事件
    	function clickImg(){
    		$(".right .oneBox").find("img").on("click",function(){
            	var length=$(".oneBox").eq(0).offset().left;
            	var current=$(this).parent().offset().left;
            	$(this).parent().children(".shape,.infoBox").toggle();
            	$(this).parent().siblings().children('.shape,.infoBox').hide();
            	if($(".sortImg").val()==1){
            		
            		$(this).parent().parent().siblings().find('.shape,.infoBox').hide();
            	}
            	$(this).parent().css("margin-bottom",140).siblings(".oneBox").css("margin-bottom",5);
            	$(this).parent().find(".infoBox").offset({left:length});
            	var infoBoxArr=document.getElementsByClassName("infoBox");
            	var oneBoxArr=document.getElementsByClassName("oneBox");
               	for(var b=0;b<infoBoxArr.length;b++){
               		if(infoBoxArr[b].style.display=="none"){
               			oneBoxArr[b].style.marginBottom="5px";
               		}
               	}

            });
    	}


		//提交信息函数
		function subInfo(text,select,userName,imgnm,index,Sinfo){
			
			$.ajax({
				url:'http://{{store_dict['remote_addr']}}:{{store_dict['port_number']}}/user-annot-status&update-img-status',
				data:{"order_idx":index,"user_name":userName,"img_name":imgnm,'annot_status':select,'annot_comment':text},
				type:'POST',
				dataType:'JSON',
				success:function(data){
					alert("保存成功!");
					judgeStatus(index,Sinfo);

					order_info(Sinfo);
					

				},
				error:function(){
					console.log(1);
				}
			})
		}
		
		//判断订单和图片的状态,文件夹级别向后台送请求，因为订单里边存放的是文件夹信息
		function judgeStatus(index,Sinfo){
			var userName=$(".userName").text();

			//var imgstatus;
			$.ajax({
				url:'http://{{store_dict['remote_addr']}}:{{store_dict['port_number']}}/user-annot-status&check-order-status',
				data:{"order_idx":index,"user_name":userName},
				type:'POST',
				dataType:'JSON',
				success:function(data){
					if(data.code==200){
						for(var i=0;i<data.status_list.length;i++){
							for(var j=0;j<$(".right .oneBox").find("span").length;j++){
								if(data.status_list[i].imgnm==$(".right .oneBox").find("span").eq(j).text()){
									$(".infoBox .imginfo").find(".imgmodify").eq(j).text("更改时间："+data.status_list[i].last_modif_time);
									$(".infoBox .comment").find("textarea").eq(j).val(""+data.status_list[i].comment);
									//给图片添加状态样式
									if(data.status_list[i].status=="ongoing"){
										$(".oneBox").eq(j).find(".imgstatus").removeAttr("class").attr("class","ongoing imgstatus");
										$(".oneBox").eq(j).find(".img_status").text("标注状态：正在进行");
										$(".oneBox").eq(j).find(".switch").css("backgroundColor","green");
										$(".oneBox").eq(j).find(".ball").css("left","25px");
										$(".oneBox").eq(j).find(".btn2").css({"color":"gray","cursor":"default"});
										($(".oneBox").eq(j).find(".gopaint"))[0].onclick=goPaint;
										
										($(".oneBox").eq(j).find(".btn1"))[0].onclick=function(){
											
											var text=$(this).parent().parent().parent().find("textarea").val();
											var select=$(this).parent().parent().parent().find("select").val();
											var userName=$(".userName").text();
											var imgnm=$(this).parent().parent().parent().find("span").text();
											subInfo(text,select,userName,imgnm,index,Sinfo);
										};
										$(".oneBox").eq(j).find("textarea").removeAttr("disabled","disabled");

									}else{
										$(".oneBox").eq(j).find(".imgstatus").removeAttr("class").attr("class","finished imgstatus");
										$(".oneBox").eq(j).find(".img_status").text("标注状态：已完成");
										$(".sortStatus").eq(j).val("accomplished");
										$(".oneBox").eq(j).find(".switch").css("backgroundColor","green");
										$(".oneBox").eq(j).find(".ball").css("left","25px");
										$(".oneBox").eq(j).find(".btn2").css("color","gray");
										($(".oneBox").eq(j).find(".btn2"))[0].onclick=function(){
											
										}
										$(".oneBox").eq(j).find("textarea").removeAttr("disabled","disabled");
										($(".oneBox").eq(j).find(".btn1"))[0].onclick=function(){
											
											var text=$(this).parent().parent().parent().find("textarea").val();
											var select=$(this).parent().parent().parent().find("select").val();
											var userName=$(".userName").text();
											var imgnm=$(this).parent().parent().parent().find("span").text();
											subInfo(text,select,userName,imgnm,index,Sinfo);
										};
										($(".oneBox").eq(j).find(".gopaint"))[0].onclick=goPaint;
									}
								}
								else{
									if($(".oneBox").eq(j).find(".imgstatus").hasClass('ongoing')||$(".oneBox").eq(j).find(".imgstatus").hasClass('finished')){
											
									}else{
										$(".oneBox").eq(j).find(".imgstatus").removeAttr("class").attr("class","nodo imgstatus");
										$(".oneBox").eq(j).find(".img_status").text("标注状态：未标注");
										$(".oneBox").eq(j).find(".switch").css("backgroundColor","red");
										$(".oneBox").eq(j).find(".ball").css("left","0");
										$(".oneBox").eq(j).find("textarea").attr("disabled","disabled");
										($(".oneBox").eq(j).find(".btn1"))[0].removeEventListener("click",subInfo);
										$(".oneBox").eq(j).find(".btn2").css({"cursor":"pointer"});
										
										($(".oneBox").eq(j).find(".btn2"))[0].onclick=function() {
											var parentOneBox=this.parentNode.parentNode.parentNode;
											var imgName=this.parentNode.parentNode.parentNode.getElementsByTagName("span")[0].innerText;
											$.ajax({
												url:'http://{{store_dict['remote_addr']}}:{{store_dict['port_number']}}/user-annot-status&append-img-status',
												data:{"order_idx":index,"user_name":userName,"img_name":imgName},
												type:'POST',
												dataType:'JSON',
												success:function(data){
													$(parentOneBox).find(".imgstatus").removeAttr("class").attr("class","ongoing imgstatus");
													$(parentOneBox).find(".switch").css("backgroundColor","green");
													$(parentOneBox).find(".ball").css("left","25px");
													$(parentOneBox).find("textarea").removeAttr("disabled");
													($(parentOneBox).find(".gopaint"))[0].onclick=goPaint;
													$(parentOneBox).find(".btn2").css({"color":"gray","cursor":"default"});
													($(".oneBox").eq(j).find(".btn1"))[0].onclick=function(){

														var text=$(this).parent().parent().parent().find("textarea").val();
														var select=$(this).parent().parent().parent().find("select").val();
														var userName=$(".userName").text();
														var imgnm=$(this).parent().parent().parent().find("span").text();
														subInfo(text,select,userName,imgnm,index);
													};
												},
												error:function(){
													console.log(1);
												}
											})
										};
									}
									
								};
							};
							//将图片信息数据添加到infoBox中
							/*$(".infoBox .imginfo").find(".imgnm").eq(i).text("图片名称："+data.status_list[i].imgnm);*/
							/*
							$(".infoBox .comment").find("textarea").eq(i).val(+data.status_list[i].comment);*/
						}
					}
					if(data.code==404){
						for(var k=0;k<$(".right .oneBox").find("span").length;k++){
							$(".oneBox").eq(k).find(".imgstatus").removeAttr("class").attr("class","nodo imgstatus");
							$(".oneBox").eq(k).find("img_info").text("标注状态：未标注");
							$(".oneBox").eq(k).find(".switch").css("backgroundColor","red");
							$(".oneBox").eq(k).find("textarea").attr("disabled","disabled");
							$(".oneBox").eq(k).find(".btn2").css({"cursor":"pointer"});
							$(".oneBox .paint").eq(k).find(".ball").css("left","0");
							($(".oneBox").eq(k).find(".btn2"))[0].onclick=function() {
								var parentOneBox=this.parentNode.parentNode.parentNode;
								var imgName=this.parentNode.parentNode.parentNode.getElementsByTagName("span")[0].innerText;
								$.ajax({
									url:'http://{{store_dict['remote_addr']}}:{{store_dict['port_number']}}/user-annot-status&append-img-status',
									data:{"order_idx":index,"user_name":userName,"img_name":imgName},
									type:'POST',
									dataType:'JSON',
									success:function(data){
										$(parentOneBox).find(".imgstatus").removeAttr("class").attr("class","imgstatus ongoing");
										$(parentOneBox).find(".switch").css("backgroundColor","green");
										$(parentOneBox).find(".ball").css("left","25px");
										$(parentOneBox).find("textarea").removeAttr("disabled");
										($(parentOneBox).find(".gopaint"))[0].onclick=goPaint;
										$(parentOneBox).find(".btn2").css({"color":"gray","cursor":"default"});
										$(parentOneBox).find(".imgstatus").removeAttr("class").attr("class","ongoing imgstatus");
										($(parentOneBox).find(".btn1"))[0].onclick=function(){

											var text=$(this).parent().parent().parent().find("textarea").val();
											var select=$(this).parent().parent().parent().find("select").val();
											var userName=$(".userName").text();
											var imgnm=$(this).parent().parent().parent().find("span").text();
											subInfo(text,select,userName,imgnm,index);
										};
									},
									error:function(){
										console.log(1);
									}
								})
							};
						}
					}
					
					

				},
				error:function(){
					console.log("1")
				}
			})
			
		}
		
		//根据图片标注状态进行分类
		function sortImg(){
			var imgOngoingData=[];//存储正在标注图片的索引值
			var imgFinishedData=[];//存储已完成图片的索引值
			var imgNodoData=[];//存储未标注图片的索引值
			for(var i=0;i<$(".imgBox").find(".imgstatus").length;i++){
				if($(".imgBox").find(".imgstatus").eq(i).hasClass("ongoing")){
					imgOngoingData.push(i);
				}else if($(".imgBox").find(".imgstatus").eq(i).hasClass("finished")){
					imgFinishedData.push(i);
				}else{
					imgNodoData.push(i);
				}
			}
			//console.log(imgOngoingData,imgFinishedData,imgNodoData);
			//console.log(($(".oneBox").eq(0))[0]);
			//$(".imgBox").html("");
			var abc="";
			var def;
			var ongoingArr=[],finishedArr=[],nodoArr=[];
			for(var a=0;a<imgOngoingData.length;a++){
				var index=imgOngoingData[a];
				def=$(".oneBox").eq(index);
				ongoingArr.push(def);
			}
			for(var b=0;b<imgFinishedData.length;b++){
				var index=imgFinishedData[b];
				def=$(".oneBox").eq(index);
				finishedArr.push(def);
			}
			for(var c=0;c<imgNodoData.length;c++){
				var index=imgNodoData[c];
				def=$(".oneBox").eq(index);
				nodoArr.push(def);
			}
			abc+='<div class="ongoingBox">'+
			'<h3>正在进行：</h3>'+
			'<hr />'+
			'</div>'+
			'<div class="finishedBox">'+
			'<h3>已完成：</h3>'+
			'<hr />'+
			'</div>'+
			'<div class="nodoBox">'+
			'<h3>未进行：</h3>'+
			'<hr />'+
			'</div>'
			$(".imgBox").html(abc);
			if(ongoingArr.length==0){
				$(".imgBox").find(".ongoingBox").hide();
			}else{
				for(var a1=0;a1<ongoingArr.length;a1++){
					$(".imgBox").find(".ongoingBox").append(ongoingArr[a1]);
				}
			}
			
			if(finishedArr.length==0){
				$(".imgBox").find(".finishedBox").hide();
			}else{
				for(var b1=0;b1<finishedArr.length;b1++){
					$(".imgBox").find(".finishedBox").append(finishedArr[b1]);
				}
			}
			
			if(nodoArr.length==0){
				$(".imgBox").find(".nodoBox").hide();
			}else{
				for(var c1=0;c1<nodoArr.length;c1++){
					$(".imgBox").find(".nodoBox").append(nodoArr[c1]);
				}
			}
		}
		function orginSort(){
			var orginArr=[];
			for(var i=0;i<$(".imgBox").find(".imgstatus").length;i++){
				orginArr.push(($(".oneBox").eq(i))[0]);
			}
			orginArr.sort(function(a,b){
				return a.dataset['index']-b.dataset['index'];
			});			
			$(".imgBox").html("");
			for(var d=0;d<orginArr.length;d++){
				$(".imgBox").append(orginArr[d]);
			}
		}

		function order_info(info){
			$(".orderInfo").show();
			var str="";
			str+=
			"<div>标注类型："+info.objtypes.substring(9)+"</div>"+
			"<div>创建时间："+info.start_time+"</div>"+
			"<div>标注用户："+info.users+"</div>"+
			"<div>描述信息："+info.description+"</div>"+
			"<select class='sortImg' id='sortImg'>"+
			"<option selected='selected' value=0>默认排序</option>"+
			"<option value=1>按标注状态排序</option>"
			"</select>";
			$(".orderInfo").html(str);
			$(".sortImg").change(function(){
				$(".infoBox,.shape").hide();
				$(".oneBox").css("marginBottom","5px");
				var infoSort=$(this).val();
				if(infoSort==0){
					orginSort();
					clickImg();
				}else{
					sortImg();
					clickImg();
				}
			});
			$(".sortImg").change();
		}
		//时间下拉框变化
		$("#selTime").change(function(){
			var opt = $(this).find("opti on:selected");
			opt.attr("selected",true);	
			selOrder(userdataArr);
			$(".right ul").html("");
			$(".orderInfo").hide();
		});
		var infoTime='<option value="all" selected="selected">全部</option>'+
				'<option value="3">过去3天</option>'+
				'<option value="7">过去7天</option>'+
				'<option value="30">过去30天</option>';
		
		$("#selTime").html(infoTime);
		//根据时间显示数据函数
		function selOrder(dataArr){
			var value=document.getElementById("selTime").value;
			
			if(value=="all"){
				leftinfo(dataArr);
			}
			else{
				var nowTime=new Date();
				var ago,agoArr,month;
				var monthArr=["Jan","Feb","Mar","Apr","May","June","July","Aug","Sep","Otc","Nov","Dec"];
				var dayArr=[];
				for(var k=0;k<dataArr.length;k++){
					ago=dataArr[k].start_time;
					
					agoDate=ago.substring(5,25);
					agoArr=agoDate.split(" ");
					for(var l=0;l<monthArr.length;l++){
						if(agoArr[1]==monthArr[l]){
							month=(l+1);
							month=month<10?"0"+month:month;
							agoArr[1]=month.toString();
						}
					}
					var target = new Date(agoArr[2]+"/"+agoArr[1]+"/"+agoArr[0]);
					var timeSum = nowTime.getTime() - target.getTime();
					var differday = parseInt(timeSum/1000/60/60/24);
					if(differday<=value){
						dayArr.push(dataArr[k]);
					}

				}
				
				leftinfo(dayArr);
				
			}
		}

		function leftinfo(data){
			//判断是否存在数据
			if(data.length==0){

				$(".left>ul").html("<li class='empty'>暂无数据！</li>");
				return
			}
			var str="";
			for(var i=0;i<data.length;i++){
				str+='<li data-index='+data[i].id+'>';
				str+='<div>订单编号:'+data[i].id+'</div>'+
					 
					 '<div>描述信息:<br>'+data[i].description+'</div>'
				str+='</li>';
			}
			
			$(".left>ul").html(str);
			
			$(".left>ul>li").click(function(){
				var color=$(this).css("backgroundColor");
				$(this).css("backgroundColor","rgba(0,0,255,.7)");
				$(this).siblings().css("backgroundColor",color);
				var index=$(this)[0].dataset['index'];
					$.ajax({
						url:'http://{{store_dict['remote_addr']}}:{{store_dict['port_number']}}/lblorder-manip&proc-order:'+index+':json',
						type:'POST',
						dataType:'JSON',
						success:function(info){
							var Sinfo=info;
							imgInfo(info.storeinfos,index,Sinfo);
							order_info(info);
						},
						error:function(){

						}
					});
			});
		}
		
		//获取数据函数
		function show(){
			$.ajax({
				url:'http://{{store_dict['remote_addr']}}:{{store_dict['port_number']}}/lblorder-manip&get-orders',
				type:'POST',
				dataType:'JSON',
				success:function(data){
					var userName=$(".userName").text();

					for(var q=0;q<data.length;q++){
						var index=data[q].users.slice(6).indexOf(userName);
						if(index!==-1){
							userdataArr.push(data[q]);										
							//showOrder(dataArr);
						}
					}

					leftinfo(userdataArr);
					
					
					
				},
				error:function(err){
					console.log(err);
				}
			})
		}
		show();
		
	    //输出系统当前时间
	    function showTime(){
	    	var time=new Date();
	    	var year=time.getFullYear();
	    	var month=time.getMonth();
	    	var day=time.getDate();
	    	var week=time.getDay();
	    	var hour=time.getHours();
	    	var minutes=time.getMinutes();
	    	var seconds=time.getSeconds();
	    	var str="";
	    	str+="今天是:"+year+"年"+(month+1)+"月"+day+"日";
	    	$(".userBox span").eq(0).html(str);
	    }
	    showTime();
	    //退出登录
	    function logOut(){
	    	$(".userBox span").eq(3).css("cursor","pointer").click(function(){
	    		$.ajax({
	                url:'http://{{store_dict['remote_addr']}}:{{store_dict['port_number']}}/logout',
	                type:'GET',
	                success:function(data){
	                    window.location.href="http://{{store_dict['remote_addr']}}:{{store_dict['port_number']}}";
	                }
            	})
	    	});

	    }
	    logOut();
	</script>
</html>